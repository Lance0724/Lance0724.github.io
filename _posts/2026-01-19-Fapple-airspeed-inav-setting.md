---
title: Fapple空速计设置(For inav v9)
layout: post
post-image: "/assets/images/QQ20240530235834.jpg"
description: inav v9中使用空速计的设置及注意事项
tags:
- Fapple
- Airspeed
- setting
- inav v9
---

在安装和设置空速计之前请先调试好飞机和飞控，待首飞完成以后再考虑安装空速计。

---

**空速计安装位置参考:**<br>
![Image1](/assets/images/c50017dd9e21457ddeb9f5648ff9eeaf.jpg)
![Image2](/assets/images/5fb531f0ef091a104c0427119ea1ad7f.jpg)
![Image3](/assets/images/Image_20240531001308.jpg)
![Image4](/assets/images/Image_20240531001255.jpg)

在 iNav v9 中安装和设置 MS4525DO 数字空速计（I2C 接口）是一项非常值得的操作，因为 v9 版本引入了 **APA（基于空速的 PID 衰减）** 和更强的传感器融合逻辑。（Fapple空速计只有V4版本才支持AT32的inav固件）

以下是针对 MS4525DO 的详细安装与设置指南：

### 第一阶段：硬件连接

MS4525DO 是一款 I2C 传感器，连接非常简单：

1. **线序连接：** * **VCC:** 连接 FC 的 5V 或 4.5V。
* **GND:** 连接 FC 的 GND。
* **SDA:** 连接 FC 的 I2C SDA 引脚。
* **SCL:** 连接 FC 的 I2C SCL 引脚。


2. **皮托管安装：**
* **位置：** 必须安装在**远离螺旋桨气流**的地方（例如机翼前端或机头正前方）。
* **进气孔（正前方）：** 侧面有凸出的部位为动压口，应当指向飞机前进方向。
* **静压孔（侧面小孔）：** 空速计的两个平面各有一个小孔（一个在插座处另一个在对向的外壳上），　请不要堵住或者覆盖这两个小孔。



---

### 第二阶段：Configurator 软件设置

1. **开启 I2C 端口：** 在 `Ports`（端口）选项卡中，确保你连接的那个 UART（如果 I2C 和 UART 复用）对应的 I2C 功能是激活的（大多数 F405/F7 飞控 I2C 是默认独立开启的，无需设置）。
2. **启用空速计：**
* 进入 `Configuration`（配置）选项卡。
* 在右侧的 `Sensors` 栏找到 **Airspeed**，点击开关。
* 在下拉菜单中选择 **MS4525**（iNav v9 已经内置了该驱动）。


3. **保存并重启：** 点击 `Save and Reboot`。

---

### 第三阶段：CLI 关键命令（v9 优化）

为了让空速计在 v9 中发挥最大作用，建议进入 `CLI` 输入以下指令：

```bash
# 强制指定硬件类型（防止自动识别失败）
set pitot_hardware = MS4525
# v9 新增：优化低通滤波，减少读数抖动（单位为毫赫兹 默认3000）
set pitot_lpf_milli_hz = 500
# 保存
save

```

---

### 第四阶段：校准与验证（核心步骤）

#### 1. 地面零点校准

* **操作：** 每次上电时，飞控会自动执行零点偏移校准。
* **关键：** 上电前**必须**用手指或保护套遮住皮托管，防止地面微风导致传感器基准值产生偏移（Offset）。

#### 2. 手动比例校准（pitot_scale）

iNav v9 仍然不支持自动比例校准，你需要手动微调：

* 在无风天进行直线飞行，观察 OSD 上的 **Airspeed（空速）** 和 **Ground Speed（地速）**。
* 如果空速比地速稳定地偏低（例如低了 10%），则需要通过 CLI 增加 `pitot_scale`：
* 输入 `get pitot_scale`（默认通常是 1.0）。
* 调整：`set pitot_scale = 1.1` (增加 10%)。



---

### 第五阶段：开启 iNav v9 的特色功能 —— APA (高级设置)

这是你使用空速计最重要的原因。APA 会根据空速自动动态调整 PID 增益，防止低速失速、高速抖动。

1. **设置参考空速：** `set fw_reference_airspeed = 1500` (设为你平时巡航的空速，单位 cm/s)。
2. **启用 APA：** 在 OSD 或 CLI 中开启相关的 PID 衰减选项。

---

### 常见问题排查

* **OSD 显示空速不为 0：** 这是因为上电时传感器没遮盖，或者传感器漂移。重新断电重启即可。
* **传感器变红（Hardware Failure）：** 检查 I2C 线序。部分 MS4525DO 模块的线序是反的（5V 和 GND 反接），这会瞬间烧毁传感器，请务必核对。


<!-- 在 iNav v9 中，**APA (Airspeed-based PID Attenuation)** 是替代传统 TPA（基于油门的 PID 衰减）的高级功能。由于空速计能直接反映飞机的物理受力情况，开启 APA 后，飞控会在高速时自动调低增益（防止抖动），在低速时自动调高增益（保持控制力），这比看油门百分比要精确得多。

以下是开启 APA 的具体参数设置和逻辑：

### 1. 核心 CLI 指令

请在 `CLI` 命令行中输入并配置以下参数：

```bash
# 1. 设置参考空速 (单位: cm/s)
# 设为你平时进行 PID 调节或执行 Autotune 时的巡航速度
set fw_reference_airspeed = 1500

# 2. 开启并设置 APA 衰减强度
# 默认值 120，范围 0-200。设为 0 会禁用 APA 并切回传统的油门 TPA
set apa_pow = 120

# 保存
save

```

---

### 2. 参数逻辑详解

* **`fw_reference_airspeed` (参考空速):**
这是最关键的参数。它告诉飞控：“在每秒 X 米的速度下，我目前的 PID 参数是最完美的”。
* **如何确定：** 如果你是在 50% 油门、时速 54km/h () 下做的 Autotune，那么就设为 `1500`。


* **`apa_pow` (衰减指数):**
它决定了增益随速度变化的“曲线陡峭度”。
* 计算公式为：
* **数值建议：** * **100:** 线性衰减，适合大多数普通练习机。
* **120-150:** 更积极的衰减，适合高速竞技机或大推重比机型。
* **注意：** 如果你在高速俯冲时飞机开始高频震动，说明衰减不够，调大此值。





---

### 3. APA 的优势（为什么要用它）

| 特性 | 传统 TPA (基于油门) | iNav v9 APA (基于空速) |
| --- | --- | --- |
| **俯冲表现** | 关掉油门俯冲时，PID 增益最高，极易发生高速振荡。 | 即使油门为 0，只要空速增加，PID 就会自动减弱，防止震动。 |
| **逆风/顺风** | 无法感知风速，地速变化会导致控制感不一致。 | 只针对通过机翼的空气流速调整，控制手感始终如一。 |
| **低速失速边缘** | 没油门滑翔时控制无力。 | 低速滑翔时自动提高增益，增强舵面响应，减少失速风险。 |

---

### 4. 调试流程建议

1. **先做 Autotune：** 在无风天，手动保持一个稳定的航速（记录下这个空速值）进行自动调参。
2. **设置参考值：** 将刚才记录的空速写入 `fw_reference_airspeed`。
3. **初次试飞：** 开启 `apa_pow = 100`。
4. **压力测试：** 在高空关闭油门，大角度俯冲。
* 如果俯冲时发生高频抖动：增加 `apa_pow`。
* 如果俯冲时感觉飞机“太软”、反应迟钝：减小 `apa_pow`。



**您目前配置的这款飞机是属于高航速的 FPV 载机，还是中低速的长航时固定翼？** 针对不同的机型，`apa_pow` 的初始值可以给您更精准的建议。

[如何通过 iNav CLI 调整固定翼 PID 参数](https://www.youtube.com/watch?v=A5i0gs9LfE8)

这段视频深入讲解了在飞行中如何实时调整 iNav 参数（包括 PID 和衰减系数），对于您调试 APA 的 `apa_pow` 参数非常有参考价值。 -->